<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evolve.AI</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Global dark theme with neon-blue accents */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #05070c;
      color: #f0f2f5;
      min-height: 100vh;
    }

    /* Navbar styles */
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: #0b1220;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    .navbar img.logo {
      width: 40px;
      height: 40px;
      object-fit: contain;
      margin-right: 0.5rem;
    }
    .navbar .brand {
      display: flex;
      align-items: center;
      font-size: 1.25rem;
      font-weight: 600;
      color: #00aaff;
    }
    .nav-links a {
      color: #a0b3c9;
      margin-left: 1rem;
      padding: 0.25rem 0.5rem;
      transition: color 0.2s;
    }
    .nav-links a:hover {
      color: #00aaff;
    }

    /* Section containers */
    .section-card {
      background: #0b1220;
      border-radius: 0.5rem;
      padding: 1.5rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.6);
      margin-bottom: 1.5rem;
    }

    /* Buttons */
    .btn-primary {
      background: #0077cc;
      color: #fff;
      padding: 0.6rem 1rem;
      border-radius: 0.375rem;
      font-weight: 600;
      transition: background 0.2s;
    }
    .btn-primary:hover {
      background: #0099ff;
    }

    /* Cards for workout/meal sections */
    .card-header {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #00aaff;
    }

    /* Scroll areas for debug/JSON panels */
    .scroll-box {
      max-height: 12rem;
      overflow-y: auto;
      background: #0f172a;
      padding: 0.75rem;
      border-radius: 0.375rem;
      font-family: monospace;
      font-size: 0.85rem;
    }

    /* Form inputs */
    .form-control input,
    .form-control select,
    .form-control textarea {
      background: #0f172a;
      color: #cbd5e1;
      border: 1px solid #26374d;
      border-radius: 0.375rem;
      padding: 0.5rem 0.75rem;
      width: 100%;
      margin-top: 0.25rem;
      margin-bottom: 0.75rem;
    }
    .form-control label {
      font-weight: 500;
      color: #94a3b8;
    }
  </style>
</head>
<body class="antialiased">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="brand">
      <img src="logo.jpeg" alt="Evolve.ai logo" class="logo" />
      evolve.ai
    </div>
    <div class="nav-links hidden md:flex">
      <a href="#dashboard">Dashboard</a>
      <a href="#profile">Profile</a>
      <a href="#pricing">Pricing</a>
      <a href="#transformations">Transformations</a>
    </div>
  </nav>

  <!-- Main container -->
  <main class="max-w-6xl mx-auto p-4 md:p-8">
    <!-- Dashboard Section -->
    <section id="dashboard" class="section-card">
      <h2 class="text-xl font-semibold mb-4 text-blue-400">Dashboard</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Calories Remaining Card -->
        <div class="bg-[#0f172a] p-6 rounded-lg shadow-md">
          <h3 class="card-header">Calories Remaining</h3>
          <div class="flex items-center justify-between">
            <span class="text-4xl font-bold" id="calsRemaining">1000</span>
            <div>
              <p class="text-sm text-gray-400">Target <span id="calsTarget">2200</span> kcal</p>
            </div>
          </div>
        </div>
        <!-- Workout Completion Card -->
        <div class="bg-[#0f172a] p-6 rounded-lg shadow-md">
          <h3 class="card-header">Workout Completion</h3>
          <div class="mb-2">
            <progress id="workoutProgress" value="0" max="1" class="w-full h-2 accent-blue-500"></progress>
          </div>
          <p class="text-sm text-gray-400"><span id="workoutSessionsDone">0</span> / <span id="workoutSessionsTotal">0</span> sessions</p>
        </div>
        <!-- This Week Card -->
        <div class="bg-[#0f172a] p-6 rounded-lg shadow-md">
          <h3 class="card-header">This Week</h3>
          <p class="text-lg font-bold mb-2" id="weeklySummary">
            0 avg kcal · 0 workouts planned
          </p>
          <p class="text-gray-400 text-sm">
            Auto-adjusts from your logs
          </p>
        </div>
      </div>

      <!-- Today's Workout & Meals -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
        <!-- Today's Workout -->
        <div class="bg-[#0f172a] p-6 rounded-lg shadow-md">
          <h3 class="card-header">Today's Workout</h3>
          <div id="todaysWorkout">
            <p class="text-gray-500 italic">Press Generate to view personalized workouts</p>
          </div>
        </div>
        <!-- Today's Meals -->
        <div class="bg-[#0f172a] p-6 rounded-lg shadow-md">
          <h3 class="card-header">Today's Meals</h3>
          <div id="todaysMeals">
            <p class="text-gray-500 italic">Press Generate to view personalized meals</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Profile Form -->
    <section id="profile" class="section-card">
      <h2 class="text-xl font-semibold mb-4 text-blue-400">Your Profile</h2>
      <form id="userForm">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="form-control">
            <label for="age">Age</label>
            <input type="number" id="age" name="age" min="1" max="99" />
          </div>
          <div class="form-control">
            <label for="sex">Sex</label>
            <select id="sex" name="sex">
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-control">
            <label for="weight">Weight (lb)</label>
            <input type="number" id="weight" name="weight" />
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="form-control">
            <label for="heightFeet">Height — Feet</label>
            <input type="number" id="heightFeet" name="heightFeet" />
          </div>
          <div class="form-control">
            <label for="heightInches">Height — Inches</label>
            <input type="number" id="heightInches" name="heightInches" />
          </div>
          <div class="form-control">
            <label for="daysPerWeek">Days per week</label>
            <input type="number" id="daysPerWeek" name="daysPerWeek" min="1" max="7" />
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-control">
            <label for="trainingPurpose">What are you training for?</label>
            <select id="trainingPurpose" name="trainingPurpose">
              <option value="general">General fitness</option>
              <option value="weight_loss">Weight loss</option>
              <option value="muscle_gain">Muscle gain</option>
              <option value="performance">Performance</option>
            </select>
          </div>
          <div class="form-control">
            <label for="sports">Do you play any sports? (comma-separated)</label>
            <input type="text" id="sports" name="sports" placeholder="e.g. soccer, basketball" />
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="form-control">
            <label for="lifestyle">Lifestyle activity</label>
            <select id="lifestyle" name="lifestyle">
              <option value="sedentary">Sedentary</option>
              <option value="light">Light</option>
              <option value="moderate" selected>Moderate</option>
              <option value="active">Active</option>
            </select>
          </div>
          <div class="form-control">
            <label for="preferredTime">Preferred training time</label>
            <select id="preferredTime" name="preferredTime">
              <option value="morning">Morning</option>
              <option value="afternoon">Afternoon</option>
              <option value="evening" selected>Evening</option>
            </select>
          </div>
          <div class="form-control">
            <label for="sessionLength">Session length (min)</label>
            <input type="number" id="sessionLength" name="sessionLength" min="10" max="120" />
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-control">
            <label for="equipment">Equipment access</label>
            <select id="equipment" name="equipment">
              <option value="none">None</option>
              <option value="home">Home gym</option>
              <option value="full">Full gym</option>
            </select>
          </div>
          <div class="form-control">
            <label for="equipmentList">Equipment list (comma-separated)</label>
            <input type="text" id="equipmentList" name="equipmentList" placeholder="e.g. dumbbells, barbell, bench" />
          </div>
        </div>
      </form>
    </section>

    <!-- Buttons for API actions -->
    <div class="flex flex-col md:flex-row md:justify-center gap-4 mb-8">
      <button id="testPing" class="btn-primary w-full md:w-auto">Test Ping</button>
      <button id="generatePlan" class="btn-primary w-full md:w-auto">Generate Plan</button>
    </div>

    <!-- Recent Activity & Debug Panels -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Recent Activity -->
      <div class="section-card">
        <h3 class="card-header">Recent Activity</h3>
        <div id="activity" class="scroll-box">
          <p class="italic text-gray-500">No recent activity yet.</p>
        </div>
      </div>
      <!-- Debug / JSON Panels -->
      <div class="section-card">
        <h3 class="card-header">Debug</h3>
        <div id="debug" class="scroll-box">
          <p class="italic text-gray-500">Debug output will appear here.</p>
        </div>
        <h3 class="card-header mt-6">Raw JSON</h3>
        <div id="rawJSON" class="scroll-box">
          <p class="italic text-gray-500">Raw JSON response will appear here.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Scripts -->
  <script>
    // API endpoints (update accordingly)
    const API_BASE = "/.netlify/functions";
    const TEST_API = API_BASE + "/testPing";
    const PLAN_API = API_BASE + "/generatePlan";

    // Helper to append logs
    function addActivity(message) {
      const activity = document.getElementById("activity");
      const entry = document.createElement("p");
      entry.textContent = "[" + new Date().toLocaleTimeString() + "] " + message;
      activity.appendChild(entry);
      activity.scrollTop = activity.scrollHeight;
    }

    // Update simple metrics (placeholder values can be changed in API response)
    function updateMetrics(data) {
      // Example fields: target_kcal, completed_sessions, total_sessions, weekly_summary
      document.getElementById("calsRemaining").textContent =
        data?.caloriesRemaining ?? "0";
      document.getElementById("calsTarget").textContent =
        data?.targetCalories ?? "0";
      document.getElementById("workoutProgress").value =
        data?.workoutCompletion ?? 0;
      document.getElementById("workoutProgress").max = 1;
      document.getElementById("workoutSessionsDone").textContent =
        data?.sessionsDone ?? "0";
      document.getElementById("workoutSessionsTotal").textContent =
        data?.sessionsTotal ?? "0";
      document.getElementById("weeklySummary").textContent =
        data?.weeklySummary ?? "0 avg kcal · 0 workouts planned";
    }

    // Populate workout and meals
    function renderPlan(plan) {
      const workoutDiv = document.getElementById("todaysWorkout");
      const mealsDiv = document.getElementById("todaysMeals");

      // Clear existing items
      workoutDiv.innerHTML = "";
      mealsDiv.innerHTML = "";

      // Render workouts
      if (plan && plan.workouts && plan.workouts.length > 0) {
        plan.workouts.forEach((w) => {
          const card = document.createElement("div");
          card.className = "mb-4";
          card.innerHTML =
            "<p class='font-medium'>" +
            w.name +
            "</p><p class='text-sm text-gray-400'>" +
            w.sets +
            "</p>";
          workoutDiv.appendChild(card);
        });
      } else {
        workoutDiv.innerHTML =
          "<p class='text-gray-500 italic'>No personalized workouts returned</p>";
      }

      // Render meals
      if (plan && plan.meals && plan.meals.length > 0) {
        plan.meals.forEach((m) => {
          const card = document.createElement("div");
          card.className = "mb-4";
          card.innerHTML =
            "<p class='font-medium'>" +
            m.title +
            "</p><p class='text-sm text-gray-400'>" +
            m.calories +
            " kcal</p>";
          mealsDiv.appendChild(card);
        });
      } else {
        mealsDiv.innerHTML =
          "<p class='text-gray-500 italic'>No personalized meals returned</p>";
      }
    }

    // Test Ping button
    document.getElementById("testPing").addEventListener("click", async () => {
      addActivity("Testing connection...");
      try {
        const res = await fetch(TEST_API);
        const data = await res.json();
        addActivity("Test response: " + JSON.stringify(data));
      } catch (err) {
        addActivity("Ping error: " + err.message);
      }
    });

    // Generate Plan button
    document
      .getElementById("generatePlan")
      .addEventListener("click", async () => {
        addActivity("Generating personalized plan...");
        const debugEl = document.getElementById("debug");
        const rawEl = document.getElementById("rawJSON");
        debugEl.textContent = "";
        rawEl.textContent = "";

        // Gather form data
        const form = document.getElementById("userForm");
        const formData = new FormData(form);
        const payload = {};
        formData.forEach((value, key) => {
          payload[key] = value;
        });

        try {
          const response = await fetch(PLAN_API, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          });
          const json = await response.json();
          rawEl.textContent = JSON.stringify(json, null, 2);

          if (json.error) {
            debugEl.textContent = "Error: " + json.error;
            addActivity("Plan generation failed.");
          } else {
            debugEl.textContent = "Plan generated successfully.";
            updateMetrics(json.metrics);
            renderPlan(json.plan);
            addActivity("Plan generated.");
          }
        } catch (err) {
          debugEl.textContent = "Network error: " + err.message;
          addActivity("Network error.");
        }
      });
  </script>
</body>
</html>
